<html>
<head>
<script src="jquery-2.1.0.min.js"></script>
<script type="text/javascript">

function bindOps(ws, ws_logs) {
  $('#insert').unbind();
  $('#find').unbind();
  $('#delete').unbind();
  $('#range').unbind();

  $('#insert').click(function() {
    var i,j,w;
    i = $('#insert_i').val();
    j = $('#insert_j').val();
    w = $('#insert_w').val();
    if (i && j && w && ws.readyState == WebSocket.OPEN) {
      var msg  = "INSERT,"+i+","+j+","+w;
      ws.send(msg);
    } else if (ws.readyState == WebSocket.OPEN) {
      ws_logs.val(ws_logs.val() + "Missing argument(s)\n");
      ws_logs[0].scrollTop = ws_logs[0].scrollHeight;
    } else {
      ws_logs.val(ws_logs.val() + "WebSocket connection error\n");
      ws_logs[0].scrollTop = ws_logs[0].scrollHeight;
    }
  });
  $('#delete').click(function() {
    var i,j;
    i = $('#delete_i').val();
    j = $('#delete_j').val();
    if (i && j && ws.readyState == WebSocket.OPEN) {
      var msg  = "DELETE,"+i+","+j;
      ws.send(msg);
    } else if (ws.readyState == WebSocket.OPEN) {
      ws_logs.val(ws_logs.val() + "Missing argument(s)\n");
      ws_logs[0].scrollTop = ws_logs[0].scrollHeight;
    } else {
      ws_logs.val(ws_logs.val() + "WebSocket connection error\n");
      ws_logs[0].scrollTop = ws_logs[0].scrollHeight;
    }
  });
  $('#find').click(function() {
    var i,j;
    i = $('#find_i').val();
    j = $('#find_j').val();
    if (i && j && ws.readyState == WebSocket.OPEN) {
      var msg  = "FIND,"+i+","+j;
      ws.send(msg);
    } else if (ws.readyState == WebSocket.OPEN) {
      ws_logs.val(ws_logs.val() + "Missing argument(s)\n");
      ws_logs[0].scrollTop = ws_logs[0].scrollHeight;
    } else {
      ws_logs.val(ws_logs.val() + "WebSocket connection error\n");
      ws_logs[0].scrollTop = ws_logs[0].scrollHeight;
    }
  });
  $('#range').click(function() {
    var i1,j1,i2,j2;
    i1 = $('#range_i1').val();
    j1 = $('#range_j1').val();
    i2 = $('#range_i2').val();
    j2 = $('#range_j2').val();
    if (i1 && j1 && j2 && j2 && ws.readyState == WebSocket.OPEN) {
      var msg  = "RANGE,"+i1+","+j1+","+i2+","+j2;
      ws.send(msg);
    } else if (ws.readyState == WebSocket.OPEN) {
      ws_logs.val(ws_logs.val() + "Missing argument(s)\n");
      ws_logs[0].scrollTop = ws_logs[0].scrollHeight;
    } else {
      ws_logs.val(ws_logs.val() + "WebSocket connection error\n");
      ws_logs[0].scrollTop = ws_logs[0].scrollHeight;
    }
  });

  $('#close').click(function() {
    ws.close();
    $('#if').hide();
    $('#start_ws').show();
  });
}

function bindSendMessage(ws, ws_logs) {
  $('#send').unbind();

  $('#send').click(function() {
    var message = $('#message').val();
    if (message && ws.readyState == WebSocket.OPEN) {
      ws.send(message);
    } else if (ws.readyState == WebSocket.OPEN) {
      ws_logs.val(ws_logs.val() + "Please enter a message to send\n");
      ws_logs[0].scrollTop = ws_logs[0].scrollHeight;
    } else {
      ws_logs.val(ws_logs.val() + "WebSocket connection error\n");
      ws_logs[0].scrollTop = ws_logs[0].scrollHeight;
    }
  });
}

function WebSocketSub()
{
  $('#start_ws').hide();

  // Clear log textarea
  var ws_logs = $('#ws_logs');
  ws_logs.val('');

  if ("WebSocket" in window) {
    var ws;
    ws = new WebSocket("ws://localhost:6767/sub");

    ws_logs.val(ws_logs.val() + "Opening WebSocket Connection...\n");
    ws_logs[0].scrollTop = ws_logs[0].scrollHeight;

    ws.onopen = function () {
      ws_logs.val(ws_logs.val() + "Opened WebSocket Connection\n");
      ws_logs[0].scrollTop = ws_logs[0].scrollHeight;

      // Show application interface
      $('#if').show();
      bindOps(ws, ws_logs);
      bindSendMessage(ws, ws_logs);
    };

    ws.onmessage = function(event) {
      var msg = event.data;
      ws_logs.val(ws_logs.val() + "Received message '" + msg + "'\n");
      ws_logs[0].scrollTop = ws_logs[0].scrollHeight;
    };

    ws.onclose = function() {
      ws_logs.val(ws_logs.val() + "Closed WebSocket Connection\n");
      ws_logs[0].scrollTop = ws_logs[0].scrollHeight;
    };

  } else {
    ws_logs.val(ws_logs.val() + "Your browser does not support WebSocket");
    ws_logs[0].scrollTop = ws_logs[0].scrollHeight;
  }
}
</script>
</head>

<body>
<div id="ws">
  <a id="start_ws" href="javascript:WebSocketSub()"> Run WebSocket </a>
  <br>
  <textarea cols="120" rows="10" id="ws_logs">
  </textarea>
  <br>
  <div id='if' style="display:none">

  <label for="insert_i">i</label>
  <input id="insert_i" type="text"/>
  <label for="insert_j">j</label>
  <input id="insert_j" type="text"/>
  <label for="insert_w">w</label>
  <input id="insert_w" type="text"/>
  <br>
  <input id="insert" type="submit" value="Insert"/>
  <br>
  <br>

  <label for="delete_i">i</label>
  <input id="delete_i" type="text"/>
  <label for="delete_j">j</label>
  <input id="delete_j" type="text"/>
  <br>
  <input id="delete" type="submit" value="Delete"/>
  <br>
  <br>

  <label for="find_i">i</label>
  <input id="find_i" type="text"/>
  <label for="find_j">j</label>
  <input id="find_j" type="text"/>
  <br>
  <input id="find" type="submit" value="Find"/>
  <br>
  <br>

  <label for="range_i1">i1</label>
  <input id="range_i1" type="text"/>
  <label for="range_j1">j1</label>
  <input id="range_j1" type="text"/>
  <label for="range_i2">i2</label>
  <input id="range_i2" type="text"/>
  <label for="range_j2">j2</label>
  <input id="range_j2" type="text"/>
  <br>
  <input id="range" type="submit" value="Range"/>
  <br>
  <br>

  <label for="message">Message</label>
  <input id="message" type="text"/>
  <input id="send" type="submit" value="Send"/>

  <br>
  <label for="close">Close connection</label>
  <input id="close" type="submit" value="Close"/>
  </div>
</div>
</body>
</html>
